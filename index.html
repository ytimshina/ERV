<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ERV Wheel Calculator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f0f4f8;
      color: #334155;
    }
    
    .card {
      background-color: white;
      border-radius: 0.75rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
      border: 1px solid rgba(226, 232, 240, 0.8);
    }
    
    .card:hover {
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
    }
    
    .form-input {
      @@apply p-3 border border-gray-300 rounded-md text-right transition;
      line-height: 1.6;
      width: 100%;
      box-sizing: border-box;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05) inset;
    }
    
    .form-input:focus {
      @@apply outline-none ring-2 ring-blue-400 border-blue-500;
      box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
    }
    
    .form-select {
      @@apply p-3 border border-gray-300 rounded-md transition;
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
      background-position: right 0.75rem center;
      background-repeat: no-repeat;
      background-size: 1.5em 1.5em;
      padding-right: 2.5rem;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      line-height: 1.6;
      width: 100%;
      box-sizing: border-box;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05) inset;
    }
    
    .form-select:focus {
      @@apply outline-none ring-2 ring-blue-400 border-blue-500;
      box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
    }
    
    .table-header {
      @@apply font-semibold text-gray-700 bg-gray-50 p-4 text-left;
      vertical-align: middle;
    }
    
    .table-data {
      @@apply p-4 border border-gray-200;
      vertical-align: middle;
    }
    
    .location-table {
      table-layout: auto;
      width: 100%;
    }
    
    .location-table th,
    .location-table td {
      width: auto;
    }
    
    .table-data-input {
      padding: 0.5rem !important;
      min-width: 4rem;
    }
    
    .table-data-input .form-input,
    .table-data-input .form-select {
      width: 100%;
      min-width: 0;
    }
    
    .section-title {
      @@apply text-lg font-semibold mb-4 text-blue-800 border-b pb-2 border-gray-200;
      letter-spacing: -0.01em;
    }
    
    .loading {
      opacity: 0.6;
      pointer-events: none;
    }
    
    button {
      transition: all 0.2s ease;
    }
    
    button:hover {
      transform: translateY(-2px);
    }
    
    .field-wrapper {
      display: flex;
      align-items: center;
      width: 100%;
    }
    
    .field-unit {
      @@apply text-xs text-gray-500 mb-1;
      position: absolute;
      top: 0;
      left: 0.5rem;
    }
    
    .field-container {
      position: relative;
      width: 100%;
    }
    
    td.align-middle {
      vertical-align: middle;
    }
    
    .slide-in {
      animation: slideIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }
    @@keyframes slideIn {
      from {
        transform: translateY(40px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .cooling-header {
      background: linear-gradient(to right, #e0f2fe, #bae6fd);
      border-radius: 6px 6px 0 0;
    }
    
    .heating-header {
      background: linear-gradient(to right, #fee2e2, #fecaca);
      border-radius: 6px 6px 0 0;
    }

    .summary-card {
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
      transition: all 0.3s ease;
    }
    
    .summary-card:hover {
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
      transform: translateY(-2px);
    }

    .animate-spin {
      animation: spin 1s linear infinite;
    }
    
    @@keyframes spin {
      from {
        transform: rotate(0deg);
      }
      to {
        transform: rotate(360deg);
      }
    }
    
    @@media (max-width: 640px) {
      .table-data-input {
        padding: 0.25rem !important;
      }
      
      .form-input, .form-select {
        padding: 0.5rem;
        font-size: 0.875rem;
      }
    }
  </style>
</head>
<body class="bg-gradient-to-b from-gray-50 to-gray-100 min-h-screen">
  <div class="p-6 w-full mx-auto">
    
    <div class="mb-10 text-center">
      
      <div class="mt-4">
        <a asp-controller="History" asp-action="Index" class="text-blue-600 hover:text-blue-800 font-medium">View Calculation History</a>
      </div>
    </div>
    
    <form id="ervForm" class="card p-8 mb-10 shadow-lg w-full">
      
      <div class="flex flex-wrap -mx-4">

        <div class="w-full lg:w-3/5 px-4 mb-8">
          <div class="card p-6 mb-8 hover:shadow-md transition-all duration-300">
            <h2 class="section-title flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-blue-600" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
              </svg>
              ERV Wheel Inputs
            </h2>
            <table class="w-full border-collapse mb-4 border rounded-lg overflow-hidden table-fixed">
              <thead>
                <tr>
                  <th class="table-header rounded-tl-lg bg-gray-100 font-medium w-1/3">Parameters</th>
                  <th class="table-header text-center cooling-header font-medium w-1/3">Cooling</th>
                  <th class="table-header text-center rounded-tr-lg heating-header font-medium w-1/3">Heating</th>
                </tr>
              </thead>
              <tbody class="w-full">
                <tr class="hover:bg-gray-50">
                  <td class="table-data font-medium align-middle">Outdoor Air Temperature (O.A. dry bulb)</td>
                  <td class="table-data align-middle table-data-input">
                    <input class="form-input" type="Number" name="OADryBulb" id="C7" placeholder="0.0"/>
                  </td>
                  <td class="table-data align-middle table-data-input">
                    <input class="form-input" type="Number" name="OADryBulb" id="D7" placeholder="0.0"/>
                  </td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="table-data font-medium align-middle">Outdoor Air Temperature (O.A. wet bulb)</td>
                  <td class="table-data align-middle table-data-input">
                    <input class="form-input" type="text" name="OAWetBulb" id="C8" placeholder="0.0"/>
                  </td>
                  <td class="table-data align-middle table-data-input">
                    <input class="form-input" type="text" name="OAWetBulb" id="D8" placeholder="0.0"/>
                  </td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="table-data font-medium align-middle">Return Air Temperature (R.A. dry bulb)</td>
                  <td class="table-data align-middle table-data-input">
                    <input class="form-input" type="text" name="RADryBulb" id="C9" placeholder="0.0"/>
                  </td>
                  <td class="table-data align-middle table-data-input">
                    <input class="form-input" type="text" name="RADryBulb" id="D9" placeholder="0.0"/>
                  </td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="table-data font-medium align-middle">Return Air Temperature (R.A. wet bulb)</td>
                  <td class="table-data align-middle table-data-input">
                    <input class="form-input" type="text" name="RAWetBulb" id="C10" placeholder="0.0"/>
                  </td>
                  <td class="table-data align-middle table-data-input">
                    <input class="form-input" type="text" name="RAWetBulb" id="D10" placeholder="0.0"/>
                  </td>
                </tr>
                <tr class="bg-gray-50">
                  <td class="table-data font-medium align-middle">OA Grains (calculated)</td>
                  <td class="table-data text-center font-mono bg-blue-50 align-middle" id="C11">--</td>
                  <td class="table-data text-center font-mono bg-red-50 align-middle" id="D11">--</td>
                </tr>
                <tr class="bg-gray-50">
                  <td class="table-data font-medium align-middle">RA Grains (calculated)</td>
                  <td class="table-data text-center font-mono bg-blue-50 align-middle" id="C12">--</td>
                  <td class="table-data text-center font-mono bg-red-50 align-middle" id="D12">--</td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="table-data font-medium align-middle">Return Air Pressure (ESP)</td>
                  <td class="table-data text-center font-mono bg-gray-50 align-middle" id="C13">--</td>
                  <td class="table-data font-medium text-center bg-blue-50 align-middle">Altitude (ft.)</td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="table-data font-medium align-middle">Nearest Location (elevation)</td>
                  <td class="table-data align-middle table-data-input">
                    <input class="form-input" type="text" name="nearestLocation" id="C14" placeholder="City name"/>
                  </td>
                  <td class="table-data text-center font-mono bg-gray-50 align-middle" id="D14">--</td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="table-data font-medium align-middle">Supply Air CFM</td>
                  <td class="table-data align-middle table-data-input">
                    <input class="form-input" type="text" name="supplyAirCFM" id="C15" placeholder="0"/>
                  </td>
                  <td class="table-data"></td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="table-data font-medium align-middle">Outdoor Air CFM</td>
                  <td class="table-data align-middle table-data-input">
                    <input class="form-input" type="text" name="F2_outdoorAirCFM" id="C16" placeholder="0"/>
                  </td>
                  <td class="table-data"></td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="table-data font-medium align-middle">Exhaust Return Air CFM</td>
                  <td class="table-data align-middle table-data-input">
                    <input class="form-input" type="text" name="exhaustReturnAirCFM" id="C17" placeholder="0"/>
                  </td>
                  <td class="table-data"></td>
                </tr>
                <tr class="bg-gray-50">
                  <td class="table-data font-medium align-middle">Mixed Return Air CFM</td>
                  <td class="table-data text-center font-mono bg-blue-50 align-middle" id="C18">--</td>
                  <td class="table-data"></td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <div class="card p-6 mb-8 hover:shadow-md transition-all duration-300">
            <h2 class="section-title flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-blue-600" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd" />
              </svg>
              Unit Selections
            </h2>
                          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6 w-full">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2" for="C21">ERV Wheel Type</label>
                <select id="C21" class="form-select" name="ervWheelType">
                  <option value="">Select Type</option>
                  <option value="1">Aluminum</option>
                  <option value="2">MS Coated</option>
                  <option value="3">Polymer</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2" for="C22">ERV Model Selection</label>
                <select id="C22" class="form-select" name="ervModelSelection">
                  <option value="">Select Model</option>
                  <option value="1">ERC</option>
                  <option value="2">HRV</option>
                  <option value="3">ERV</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2" for="C23">ERV Size Selection</label>
                <select id="C23" class="form-select" name="ervSizeSelection">
                  <option value="">Select Size</option>
                  <option value="1">Small (10-20)</option>
                  <option value="2">Medium (30-50)</option>
                  <option value="3">Large (60-100)</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2" for="C24">Filter Type</label>
                <select id="C24" class="form-select" name="filterType">
                  <option value="">Select Filter</option>
                  <option value="1">MERV 8</option>
                  <option value="2">MERV 13</option>
                  <option value="3">HEPA</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2" for="C25">Purge Type</label>
                <select id="C25" class="form-select" name="purgeType">
                  <option value="">Select Purge</option>
                  <option value="0">0°</option>
                  <option value="5">5°</option>
                  <option value="10">10°</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2" for="C28">Unit Voltage</label>
                <select id="C28" class="form-select" name="unitVoltage">
                  <option value="">Select Voltage</option>
                  <option value="110">110V</option>
                  <option value="220">220V</option>
                  <option value="440">440V</option>
                </select>
              </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2" for="C26">Trane Original Unit Tons</label>
                <select id="C26" class="form-select" name="traneOriginalTons">
                  <option value="">Select Tons</option>
                  <option value="3">3 Tons</option>
                  <option value="5">5 Tons</option>
                  <option value="10">10 Tons</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2" for="D26">Tonnage with ERV</label>
                <div class="form-input bg-gray-50 text-blue-800 font-medium" id="D26">--</div>
              </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6 w-full">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2" for="C27">Trane Stated EER</label>
                <select id="C27" class="form-select" name="traneStatedEER">
                  <option value="">Select EER</option>
                  <option value="10">10.0</option>
                  <option value="11">11.0</option>
                  <option value="12">12.0</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2" for="D27">EER Value</label>
                <div class="form-input bg-gray-50 text-green-800 font-medium" id="D27">--</div>
              </div>
            </div>
          </div>
          
          <div class="card p-6 hover:shadow-md transition-all duration-300">
            <h2 class="section-title flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-blue-600" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd" />
              </svg>
              Pre-Heater &amp; Post Preheat Data
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2" for="H26">Pre-Heater Size:</label>
                <input class="form-input" type="number" name="preHeaterSize" id="H26" placeholder="10"/>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Post Preheat Air Temp</label>
                <div class="form-input bg-gray-50 text-blue-800 font-medium mb-3" id="I26">--</div>
                <div class="form-input bg-gray-50 text-red-800 font-medium" id="I27">--</div>
              </div>
            </div>
          </div>
        </div>

        <div class="w-full lg:w-2/5 px-4">
          <div class="card p-6 mb-8 hover:shadow-md transition-all duration-300">
            <h2 class="section-title flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-blue-600" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
              </svg>
              Location Information
            </h2>
            <table class="w-full border-collapse mb-2 border rounded-lg overflow-hidden location-table">
              <thead>
                <tr>
                  <th class="table-header text-left rounded-tl-lg bg-gray-100"></th>
                  <th class="table-header text-center bg-gray-100">City</th>
                  <th class="table-header text-center rounded-tr-lg bg-gray-100">Altitude (ft.)</th>
                </tr>
              </thead>
              <tbody>
                <tr class="hover:bg-gray-50">
                  <td class="table-data font-medium align-middle">Nearest Location (elevation)</td>
                  <td class="table-data align-middle table-data-input">
                    <input class="form-input w-full" type="text" name="R1_nearestLocation" id="AE5" placeholder="City name"/>
                  </td>
                  <td class="table-data align-middle table-data-input">
                    <input class="form-input w-full" type="text" name="R2_altitude" id="AF5" placeholder="0"/>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="card p-6 mb-8 hover:shadow-md transition-all duration-300">
            <h2 class="section-title flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-blue-600" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
              </svg>
              Fan Data
            </h2>
            <table class="w-full border-collapse mb-2 border rounded-lg overflow-hidden">
              <tbody>
                <tr class="hover:bg-gray-50">
                  <td class="table-data font-medium align-middle bg-gray-50">Fan Type</td>
                  <td class="table-data font-mono align-middle text-blue-800" id="H6">--</td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="table-data font-medium align-middle bg-gray-50">Motor Size (HP)</td>
                  <td class="table-data font-mono align-middle text-blue-800" id="H7">--</td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="table-data font-medium align-middle bg-gray-50">Fan RPM</td>
                  <td class="table-data font-mono align-middle text-blue-800" id="H8">--</td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="table-data font-medium align-middle bg-gray-50">Fan/Motor BHP</td>
                  <td class="table-data font-mono align-middle text-blue-800" id="H9">--</td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="table-data font-medium align-middle bg-gray-50">Total Static Pressure</td>
                  <td class="table-data font-mono align-middle text-blue-800" id="H10">--</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="card p-6 mb-8 hover:shadow-md transition-all duration-300">
            <h2 class="section-title flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-blue-600" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633zM5.707 6.293a1 1 0 010 1.414L3.414 10l2.293 2.293a1 1 0 11-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0zm8.586 0a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 11-1.414-1.414L16.586 10l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
              </svg>
              Motor, Belt and Pullies
            </h2>
            <div class="grid grid-cols-1 gap-6 mb-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2" for="H13">Motor with grounding ring?</label>
                <select name="motorGroundingRing" id="H13" class="form-select">
                  <option value="">Select Option</option>
                  <option value="0">No</option>
                  <option value="1">Yes</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2" for="H14">VAV system with VDF?</label>
                <select name="vavSystemVdf" id="H14" class="form-select">
                  <option value="">Select Option</option>
                  <option value="0">No</option>
                  <option value="1">Yes</option>
                </select>
              </div>
            </div>
            
            <table class="w-full border-collapse border rounded-lg overflow-hidden">
              <thead>
                <tr>
                  <th class="table-header text-left rounded-tl-lg bg-gray-100">Part</th>
                  <th class="table-header text-center bg-gray-100">Value</th>
                  <th class="table-header text-center rounded-tr-lg bg-gray-100">PN</th>
                </tr>
              </thead>
              <tbody>
                <tr class="hover:bg-gray-50">
                  <td class="table-data font-medium align-middle bg-gray-50">Motor:</td>
                  <td class="table-data font-mono text-center align-middle text-blue-800" id="G16">--</td>
                  <td class="table-data font-mono text-center align-middle text-blue-800" id="H16">--</td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="table-data font-medium align-middle bg-gray-50">Driver:</td>
                  <td class="table-data font-mono text-center align-middle text-blue-800" id="G17">--</td>
                  <td class="table-data font-mono text-center align-middle text-blue-800" id="H17">--</td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="table-data font-medium align-middle bg-gray-50">Driven:</td>
                  <td class="table-data font-mono text-center align-middle text-blue-800" id="G18">--</td>
                  <td class="table-data font-mono text-center align-middle text-blue-800" id="H18">--</td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="table-data font-medium align-middle bg-gray-50">Belt:</td>
                  <td class="table-data font-mono text-center align-middle text-blue-800" id="G19">--</td>
                  <td class="table-data font-mono text-center align-middle text-blue-800" id="H19">--</td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="table-data font-medium align-middle bg-gray-50">RPM:</td>
                  <td class="table-data font-mono text-center align-middle text-blue-800" colspan="2" id="H20">--</td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <div class="text-center mt-8">
            <button 
              type="submit"
              class="px-8 py-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50 shadow-lg w-full font-medium text-lg transition-all duration-300"
            >
              Calculate Results
            </button>
          </div>
        </div>
      </div>
    </form>

    <div id="resultsWidget" class="hidden w-full">
      <div class="card p-8 mb-10 shadow-xl slide-in w-full">
        <div class="flex justify-between items-center mb-6 border-b pb-4 border-gray-200">
          <h2 class="text-2xl font-bold text-blue-900">Performance Results</h2>
          <button id="saveResultsBtn" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-4 focus:ring-green-500 focus:ring-opacity-50 shadow-md flex items-center transition-all duration-300">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2" viewBox="0 0 20 20" fill="currentColor">
              <path d="M7.707 10.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V6h5a2 2 0 012 2v7a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2h5v5.586l-1.293-1.293zM9 4a1 1 0 012 0v2H9V4z" />
            </svg>
            Save Results
          </button>
        </div>
        
        <div class="overflow-x-auto rounded-lg shadow-sm border border-gray-200 w-full">
          <table class="w-full border-collapse" style="min-width: 1200px;">
            <thead>
              <tr class="bg-gray-50">
                <th class="border border-gray-300 p-4 bg-white text-left font-semibold text-gray-800 rounded-tl-lg">
                  Aluminum ERC Series (Airxchange)
                </th>
                <th class="border border-gray-300 p-4 bg-white text-center font-semibold text-gray-800">
                  Unit<br>Effectiveness
                </th>
                <th class="border border-gray-300 p-4 text-center font-semibold text-gray-800 bg-gray-50">
                  ERV Air<br>Pressure Loss
                </th>
                <th class="border border-gray-300 p-4 text-center font-semibold text-gray-800 bg-gray-50">
                  Velocity
                </th>
                <th class="border border-gray-300 p-4 bg-white text-center font-semibold text-gray-800">
                  ERV Dry<br>(bulb °F)
                </th>
                <th class="border border-gray-300 p-4 bg-white text-center font-semibold text-gray-800">
                  ERV Wet<br>(bulb °F)
                </th>
                <th class="border border-gray-300 p-4 text-center font-semibold text-gray-800 bg-gray-50">
                  M.S.A. Dry<br>Bulb (°F)
                </th>
                <th class="border border-gray-300 p-4 text-center font-semibold text-gray-800 bg-gray-50">
                  M.S.A. Wet<br>Bulb (°F)
                </th>
                <th class="border border-gray-300 p-4 bg-white text-center font-semibold text-gray-800">
                  ERV effective<br>Cooling (Tons)
                </th>
                <th class="border border-gray-300 p-4 text-center font-semibold text-gray-800 rounded-tr-lg bg-gray-50">
                  Cooling<br>(Sensible MBH)
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="border border-gray-300 p-4 font-medium cooling-header" colspan="10">
                  Summer Performance (Cooling Data)
                </td>
              </tr>
              <tr class="hover:bg-blue-50 transition-colors duration-150">
                <td class="border p-4 font-medium bg-gray-50" id="B33">--</td>
                <td class="border p-4 text-center font-mono" id="C33">--</td>
                <td class="border p-4 text-center font-mono bg-gray-50" id="D33">--</td>
                <td class="border p-4 text-center font-mono bg-gray-50" id="E33">--</td>
                <td class="border p-4 text-center font-mono" id="F33">--</td>
                <td class="border p-4 text-center font-mono" id="G33">--</td>
                <td class="border p-4 text-center font-mono bg-gray-50" id="H33">--</td>
                <td class="border p-4 text-center font-mono bg-gray-50" id="I33">--</td>
                <td class="border p-4 text-center font-mono" id="J33">--</td>
                <td class="border p-4 text-center font-mono bg-gray-50" id="K33">--</td>
              </tr>

              <tr>
                <td class="border border-gray-300 p-4 font-medium heating-header" colspan="10">
                  Winter Performance (Heating Data)
                </td>
              </tr>
              <tr class="hover:bg-red-50 transition-colors duration-150">
                <td class="border p-4 font-medium bg-gray-50" id="B35">--</td>
                <td class="border p-4 text-center font-mono" id="C35">--</td>
                <td class="border p-4 text-center font-mono bg-gray-50" id="D35">--</td>
                <td class="border p-4 text-center font-mono bg-gray-50" id="E35">--</td>
                <td class="border p-4 text-center font-mono" id="F35">--</td>
                <td class="border p-4 text-center font-mono" id="G35">--</td>
                <td class="border p-4 text-center font-mono bg-gray-50" id="H35">--</td>
                <td class="border p-4 text-center font-mono bg-gray-50" id="I35">--</td>
                <td class="border p-4 text-center font-mono" id="J35">--</td>
                <td class="border p-4 text-center font-mono bg-gray-50 rounded-br-lg" id="K35">--</td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <div class="mt-6 p-4 bg-gray-50 rounded-lg">
          <h3 class="text-lg font-medium text-gray-700 mb-2">Add a Description (Optional)</h3>
          <input type="text" id="calculation-description" class="w-full p-2 border border-gray-300 rounded" 
                 placeholder="E.g., Summer calculation for Building A"/>
        </div>
      </div>
    </div>
    
    <div class="text-center text-gray-500 text-sm mt-12 mb-6">
    </div>
  </div>

  <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-70 hidden flex items-center justify-center z-50">
    <div class="bg-white p-8 rounded-xl shadow-2xl">
      <p class="text-lg flex items-center">
        <svg class="animate-spin h-8 w-8 mr-4 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        Processing your request...
      </p>
    </div>
  </div>

  <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-xl shadow-2xl max-w-md w-full">
      <div class="text-center">
        <svg class="mx-auto h-12 w-12 text-green-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg>
        <h3 class="mt-2 text-xl font-medium text-gray-900">Calculation Saved!</h3>
        <p class="mt-2 text-gray-600">Your calculation has been saved successfully.</p>
        <div class="mt-4 flex justify-center space-x-4">
          <button type="button" id="closeSuccessBtn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">
            Close
          </button>
          <a href="/History" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
            View History
          </a>
        </div>
      </div>
    </div>
  </div>

  <script>
    const SERVER_URL = 'https://793d-76-160-216-133.ngrok-free.app';

    const INPUT_FIELDS = [
        'C7', 'C8', 'C9', 'C10', 
        'D7', 'D8', 'D9', 'D10', 
        'C13', 'C15', 'C16', 'C17',
        'C21', 'C22', 'C23', 'C24', 'C25', 'C26', 'C27', 'C28',
        'H13', 'H14', 'H26',
        'AE5', 'AF5'
    ];

    const OUTPUT_FIELDS = [
        'C11', 'C12', 'D11', 'D12', 'C14', 'D14', 'C18', 'D20', 'D26', 'D27',
        'H6', 'H7', 'H8', 'H9', 'H10',
        'G16', 'G17', 'G18', 'G19', 'G20',
        'H16', 'H17', 'H18', 'H19',
        'I26', 'I27',
        'B33', 'C33', 'D33', 'E33', 'F33', 'G33', 'H33', 'I33', 'J33', 'K33',
        'B35', 'C35', 'D35', 'E35', 'F35', 'G35', 'H35', 'I35', 'J35', 'K35'
    ];

    function showLoading() {
        document.getElementById('loadingOverlay').classList.remove('hidden');
        document.getElementById('loadingOverlay').classList.add('flex');
        document.querySelector('form').classList.add('loading');
        const submitButton = document.querySelector('button[type="submit"]');
        if (submitButton) {
            submitButton.disabled = true;
        }
    }

    function hideLoading() {
        document.getElementById('loadingOverlay').classList.add('hidden');
        document.getElementById('loadingOverlay').classList.remove('flex');
        document.querySelector('form').classList.remove('loading');
        const submitButton = document.querySelector('button[type="submit"]');
        if (submitButton) {
            submitButton.disabled = false;
        }
    }

    function showSuccessModal() {
        const modal = document.getElementById('successModal');
        modal.classList.remove('hidden');
        modal.classList.add('flex');
    }

    function hideSuccessModal() {
        const modal = document.getElementById('successModal');
        modal.classList.add('hidden');
        modal.classList.remove('flex');
    }

    function collectInputValues() {
        const inputs = {};
        let hasChanges = false;

        INPUT_FIELDS.forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                if (element.tagName === 'SELECT') {
                    if (element.value !== '') {
                        const value = !isNaN(element.value) ? Number(element.value) : element.value;
                        inputs[id] = value;
                        hasChanges = true;
                    }
                }
                else if (element.value && element.value.trim() !== '') {
                    if (element.type === 'number') {
                        const value = Number(element.value);
                        if (!isNaN(value)) {
                            inputs[id] = value;
                            hasChanges = true;
                        }
                    } else {
                        inputs[id] = element.value.trim();
                        hasChanges = true;
                    }
                }
            }
        });

        return { inputs, hasChanges };
    }

    async function updateExcelOutputs() {
        const { inputs, hasChanges } = collectInputValues();
        
        if (!hasChanges) {
            console.log('No valid inputs to send');
            return;
        }

        console.log('Sending to Excel:', inputs);
        showLoading();
        
        try {
            const response = await fetch(`${SERVER_URL}/update-excel`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ inputValue: inputs }),
            });

            const data = await response.json();

            if (data.success) {
                Object.entries(data.result).forEach(([cellId, value]) => {
                    let element = document.getElementById(cellId);
                    if (!element && cellId === 'B33') {
                        element = document.getElementById('B33_model');
                    }
                    if (!element && cellId === 'B33_model') {
                        element = document.getElementById('B33');
                    }
                    
                    if (element) {
                        console.log(`Updating ${cellId} with value:`, value);
                        const numValue = parseFloat(value);
                        if (!isNaN(numValue)) {
                            element.textContent = numValue.toFixed(2);
                        } else {
                            element.textContent = value;
                        }
                    }
                });
                
                document.getElementById('resultsWidget').classList.remove('hidden');
                
                document.getElementById('resultsWidget').scrollIntoView({ behavior: 'smooth' });
            } else {
                console.error('Error:', data.error);
                alert('Error updating values. Please check the console for details.');
            }
        } catch (error) {
            console.error('Connection error:', error);
            alert('Failed to connect to the server. Please check your connection.');
        } finally {
            hideLoading();
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const form = document.querySelector('form');
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            updateExcelOutputs();
        });

        const saveResultsBtn = document.getElementById('saveResultsBtn');
        saveResultsBtn.addEventListener('click', async () => {
            const { inputs } = collectInputValues();
            
            const results = {};
            OUTPUT_FIELDS.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    results[id] = element.textContent;
                }
            });
            
            const descriptionInput = document.getElementById('calculation-description');
            const description = descriptionInput.value.trim() || 'ERV Wheel Calculation';
            
            showLoading();
            
            try {
                const response = await fetch('/History/SaveCalculation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                    },
                    body: JSON.stringify({
                        inputs: inputs,
                        results: results,
                        description: description
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    hideLoading();
                    showSuccessModal();
                } else {
                    hideLoading();
                    alert('Error saving calculation. Please try again.');
                }
            } catch (error) {
                console.error('Connection error:', error);
                hideLoading();
                alert('Failed to save calculation. Please check your connection.');
            }
        });

        const closeSuccessBtn = document.getElementById('closeSuccessBtn');
        if (closeSuccessBtn) {
            closeSuccessBtn.addEventListener('click', hideSuccessModal);
        }

        INPUT_FIELDS.forEach(id => {
            const element = document.getElementById(id);
            if (element && element.type === 'number') {
                element.addEventListener('input', () => {
                    if (element.value !== '') {
                        const num = parseFloat(element.value);
                        if (isNaN(num)) {
                            element.setCustomValidity('Please enter a valid number');
                        } else {
                            element.setCustomValidity('');
                        }
                    }
                });
            }
        });

        testConnection();
    });

    async function testConnection() {
        try {
            const response = await fetch(`${SERVER_URL}/test`);
            const data = await response.json();
            
            if (!data.success || !data.fileExists) {
                console.error('Server setup issue:', data);
                alert('Warning: Server connection issue or Excel file not found. Please check the server setup.');
            } else {
                console.log('Server connected successfully');
            }
        } catch (error) {
            console.error('Server connection failed:', error);
        }
    }
  </script>
</body>
</html>